<style>
  @keyframes spin {
    from { transform: rotate(0deg); }
    to { transform: rotate(360deg); }
  }
</style>

<div class="audio-player bg-white rounded-lg shadow-2xl p-6 w-full" 
     data-controller="audio-player"
     data-audio-player-src-value="<%= local_assigns[:src] || '' %>"
     >
  <!-- Main Player Layout -->
  <div class="flex items-center space-x-6">
    <!-- Left: Play/Pause Button -->
    <div class="flex-shrink-0">
      <div class="relative w-20 h-20 rounded-full transition-all duration-300 shadow-2xl overflow-hidden cursor-pointer hover:scale-105 active:scale-95" 
           data-audio-player-target="playButton"
           data-action="click->audio-player#togglePlay">
        <!-- Cover Image Background -->
        <div class="absolute inset-0 w-full h-full transition-transform duration-3000 ease-in-out z-10" 
             data-audio-player-target="coverImage">
          <img src="<%= local_assigns[:cover] || asset_path("omshow.png") %>" 
               alt="Cover" 
               class="w-full h-full object-cover rounded-full border-2 border-white shadow-inner"
               onload="console.log('Cover image loaded successfully:', this.src); this.style.opacity='1';"
               onerror="console.log('Cover image failed to load:', this.src); this.style.opacity='0.3'; this.style.filter='grayscale(100%)';"
               style="opacity: 0; transition: opacity 0.3s ease-in-out;">
        </div>
        
        <!-- Play Icon Overlay -->
        <div class="absolute inset-0 flex items-center justify-center z-20">
          <svg class="w-8 h-8 text-white drop-shadow-lg" fill="currentColor" viewBox="0 0 20 20" data-audio-player-target="playIcon">
            <path d="M7 5v10l8-5-8-5z"/>
          </svg>
          <svg class="w-8 h-8 text-white drop-shadow-lg hidden" fill="currentColor" viewBox="0 0 20 20" data-audio-player-target="pauseIcon">
            <path d="M6 4h2v12H6V4zm6 0h2v12h-2V4z"/>
          </svg>
        </div>
      </div>
    </div>

    <!-- Right: Progress Bar and Volume Control -->
    <div class="flex-1 space-y-4">
      <!-- Progress Bar -->
      <div>
        <div class="flex justify-between text-sm text-gray-500 mb-2">
          <span data-audio-player-target="currentTime">0:00</span>
          <span data-audio-player-target="duration">0:00</span>
        </div>
        <div class="relative">
          <div class="w-full bg-gray-200 rounded-full h-3">
            <div class="bg-green-600 h-3 rounded-full transition-all duration-300" 
                 data-audio-player-target="progressBar"
                 style="width: 0%"></div>
          </div>
          <input type="range" 
                 class="absolute inset-0 w-full h-3 opacity-0 cursor-pointer" 
                 data-audio-player-target="progressSlider"
                 min="0" 
                 max="100" 
                 step="0.1"
                 value="0">
        </div>
      </div>

      <!-- Volume Control -->
      <div class="flex items-center space-x-3">
        <input type="range" 
               class="flex-1 h-3 bg-gray-200 rounded-lg appearance-none cursor-pointer" 
               data-audio-player-target="volumeSlider"
               min="0" 
               max="100" 
               value="100"
               data-action="input->audio-player#setVolume">
        <span class="text-sm text-gray-500 w-16 text-right flex-shrink-0" data-audio-player-target="volumeText">100%</span>
      </div>
    </div>
  </div>

  <!-- Loading State -->
  <div class="hidden text-center text-gray-500 mt-6" data-audio-player-target="loadingState">
    <div class="inline-block animate-spin rounded-full h-6 w-6 border-b-2 border-blue-600"></div>
    <span class="ml-2">Loading...</span>
  </div>

  <!-- Error State -->
  <div class="hidden text-center text-red-500 mt-6" data-audio-player-target="errorState">
    <span>Failed to load audio</span>
  </div>
</div>
